{
    "image": "mcr.microsoft.com/devcontainers/base:ubuntu",
    "features": {
        "ghcr.io/devcontainers/features/common-utils:2": {},
        "ghcr.io/devcontainers/features/git:1": {}
    },
    "postCreateCommand": [
        "sudo apt update",
        "git clone https://github.com/leoleo0980627-web/git_pan /workspaces/git_pan_local || true",
        
        "cat > /workspaces/smart_parallel_install.sh << 'EOF'",
        "#!/bin/bash",
        "echo 'üöÄ Êô∫ËÉΩ‰∏¶Ë°åÂÆâË£ùÁ≥ªÁµ±'",
        "echo '===================='",
        "",
        "# Âü∫Á§éÂÆâË£ùÂàóË°®",
        "base_packages=\"fish chafa tty-clock netris libcaca-utils cmatrix sl cowsay fortune\"",
        "",
        "# Ê™¢Êü•Ë®òÊÜ∂Ê™îÊ°à‰∏≠ÁöÑÈ°çÂ§ñÂ•ó‰ª∂",
        "APT_HISTORY=\"/workspaces/apt_history.txt\"",
        "extra_packages=\"\"",
        "if [ -f \"$APT_HISTORY\" ]; then",
        "    echo 'üìö Ê™¢Ê∏¨Âà∞Ê≠∑Âè≤ÂÆâË£ùË®òÈåÑ...'",
        "    while IFS= read -r line; do",
        "        if [[ \"$line\" =~ sudo\\ apt\\ install\\ -y\\ (.*) ]]; then",
        "            extra_packages=\"$extra_packages ${BASH_REMATCH[1]}\"",
        "        fi",
        "    done < \"$APT_HISTORY\"",
        "fi",
        "",
        "# Âêà‰ΩµÊâÄÊúâÂ•ó‰ª∂ÔºåÂéªÈô§ÈáçË§á",
        "all_packages=$(echo \"$base_packages $extra_packages\" | tr ' ' '\\n' | sort -u | tr '\\n' ' ')",
        "total_packages=$(echo \"$all_packages\" | wc -w)",
        "",
        "echo \"üì¶ Á∏ΩÂÖ±ÂÆâË£ù $total_packages ÂÄãÂ•ó‰ª∂\"",
        "echo \"üîß Â•ó‰ª∂ÂàóË°®: $all_packages\"",
        "echo ''",
        "echo '‚è≥ ÈñãÂßã‰∏¶Ë°åÂÆâË£ù...'",
        "",
        "# ‰∏¶Ë°åÂÆâË£ù",
        "sudo apt install -y $all_packages",
        "",
        "echo '‚úÖ ÊâÄÊúâÂ•ó‰ª∂ÂÆâË£ùÂÆåÊàêÔºÅ'",
        "EOF",
        
        "chmod +x /workspaces/smart_parallel_install.sh",
        "/workspaces/smart_parallel_install.sh",
        
        "# Ë®≠ÁΩÆË®òÊÜ∂Á≥ªÁµ±",
        "cat > /workspaces/apt_memory.sh << 'EOF'",
        "#!/bin/bash",
        "APT_HISTORY=\"/workspaces/apt_history.txt\"",
        "touch \"$APT_HISTORY\"",
        "echo 'üì¶ Apt Ë®òÊÜ∂Á≥ªÁµ±Â∑≤Â∞±Á∑í'",
        "echo 'üíæ Ê≠∑Âè≤Ë®òÈåÑ‰ΩçÁΩÆ: $APT_HISTORY'",
        "EOF",
        
        "chmod +x /workspaces/apt_memory.sh",
        
        "# Fish ÈÖçÁΩÆÔºàÂåÖÂê´Ëá™ÂãïË®òÈåÑÔºâ",
        "mkdir -p ~/.config/fish", 
        "cat > ~/.config/fish/config.fish << 'FISHCONFIG'",
        "function apt",
        "    if contains install \\$argv[1]",
        "        command apt \\$argv",
        "        if test \\$status -eq 0",
        "            set -l packages (string join \" \" \\$argv[2..-1])",
        "            echo \"sudo apt install -y \\$packages\" >> /workspaces/apt_history.txt",
        "            echo \"üì¶ Â∑≤Ë®òÈåÑ: \\$packages\"",
        "        end",
        "    else",
        "        command apt \\$argv",
        "    end",
        "end",
        "",
        "function fish_prompt",
        "    if test -n \"\\$SSH_TTY\"",
        "        echo -n (set_color brred)\"\\$USER\"(set_color white)'@'(set_color yellow)(prompt_hostname)' '",
        "    end",
        "    echo -n (set_color blue)(prompt_pwd)' '",
        "    set_color -o",
        "    if fish_is_root_user",
        "        echo -n (set_color red)'# '",
        "    end",
        "    echo -n (set_color red)'‚ùØ'(set_color yellow)'‚ùØ'(set_color green)'‚ùØ '",
        "    set_color normal",
        "end",
        "FISHCONFIG",
        
        "chsh -s /usr/bin/fish",
        "sleep 1",
        "clear && fish"
    ],
    "customizations": {
        "vscode": {
            "extensions": [
                "ms-python.python",
                "github.copilot"
            ]
        }
    }
}
